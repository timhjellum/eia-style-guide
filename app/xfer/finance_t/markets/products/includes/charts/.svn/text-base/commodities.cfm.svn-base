 	<style>
		#efmi_ofm {
			width:100%;
		}
		#efmi_ofm .qtr {
			width: 25%;
			height:100%;
		}
		#legend {
			margin-top:	2.5em;
			padding: 0;
			text-align: center;
		}
		#efmi_ofm span,
		#legend span{
			font-weight: bold;
			display: inline-block;
		}
		#legend .vals {
			height: 20px;
	    width: 85px;
		}
		
		#legend div span{
			width: 50%;
			text-align: center;
		}
		#efmi_ofm tr td {
			border-bottom: 1px solid gray;
			border-right: 1px solid gray;
			height: 40px;
			padding: 0;
		}
		
		#efmi_ofm tr th{
			border-bottom: none;
			text-align: center;
		}
		
		#efmi_ofm td.first_col {
			background-color: white;
			border-left: 1px solid gray;
			text-align: center;
			padding: 0 5px;
			vertical-align: bottom;
		}
		
		.negative.low {
			background-color: #4cc9ff;
		}
		.negative.med {
			background-color: #0196d8;
		}
		.negative.high{
			background-color: #00628c;
		}
		
		.positive.low {
			background-color: #91c767;
		}
		.positive.med {
			background-color: #5d9731;
		}
		.positive.high{
			background-color: #32630c;
		}
		.empty {
			background-color: white;
		}
		.noVal {
			background-color: lightgray;
		}
		#efmi_ofm span.oilPeak {
			border-left: 2px solid black;
			margin-right: -2px;
		}
	 .peakLbl{
			position: absolute;
		}
	</style>
  <cftry>  
	<script type="text/javascript">
		$(function(){
			var label = $('.peakLbl'),
					offset = $('.oilPeak').offset(),
					width = label.width();
					
			label.css( 'left',offset.left - (width/2) );
		});
	</script>
  
  <cfquery name="query3" datasource="energystatsweb" cachedwithin="#CreateTimeSpan(0,1,0,0)#">
    SELECT substr(yyyyqq_datex,4,4) as year, substr(yyyyqq_datex,0,1) as qtr, nat_gas as ngas,  gold, copper, silver, soy, corn, wheat
    FROM energystats.efmi_other_financial_markets
  </cfquery>

	<cfset ngasArr2 = structNew() >
	<cfset goldArr2 = structNew() >
	<cfset copperArr2 = structNew() >
   	<cfset silverArr2 = structNew() >
    <cfset soyArr2 = structNew() >
    <cfset cornArr2 = structNew() >
    <cfset wheatArr2 = structNew() >

  <cfloop query="query3" >
    <cfset ngasArr2[#year#][#qtr#] = #ngas#  >
    <cfset goldArr2[#year#][#qtr#] = #gold# >
    <cfset copperArr2[#year#][#qtr#] = #copper# >
    <cfset silverArr2[#year#][#qtr#] = #silver# >
    <cfset soyArr2[#year#][#qtr#] = #soy# >
    <cfset cornArr2[#year#][#qtr#] = #corn# >
    <cfset wheatArr2[#year#][#qtr#] = #wheat# >    
  </cfloop>
  

  <cfscript>
		function getClassForValue2( value ){
			
			if( value EQ 'noVal' )
				return 'noVal';
			
			if( value LT -0.26 )
				class = "negative";
			else if( value GT 0.26 )
				class = "positive";
			else
				class = "empty";
				

			value = Abs(value);
			
			if ( value GT 0.26 AND value LT 0.4 )
				class = class & " low";
				
			else if ( value GT 0.40 AND value LT 0.65 )
				class = class & " med";
				
			else if ( value GT 0.65 )
				class = class & " high";
				
			else
				class = class & " empty";

			return class;
		}
		
		function isArrayElementDefined2(arrayName){
			//use try{} to attempt using the array element
			try{
				//use the array element and return true
				testVar = evaluate(arrayName);
				return true;
			//if using it causes an error catch it and return false
			}catch(any test){
				return false;
        }
    }
		
		keyArr2 = StructkeyArray(ngasArr2);
		ArraySort(keyArr2,'text','asc' );
		
		header = '';
		ngasRow = '<td class="first_col">Natural Gas</td>';
		goldRow = '<td class="first_col">Gold</td>';
		copperRow = '<td class="first_col">Copper</td>';
		silverRow = '<td class="first_col">Silver</td>';
		soyRow = '<td class="first_col">Soybeans</td>';
		cornRow = '<td class="first_col">Corn</td>';
		wheatRow = '<td class="first_col">Wheat</td>';
	</cfscript>

<div style=" margin-bottom: -5px; font-size:16px; font-weight:bold;">Correlations between daily price changes of crude oil and other commodities</div>
	<div>
  	<table id="efmi_ofm" style="color:white;">
    
    	<cfoutput>
				
        <cfloop from="1" to="#arrayLen(keyArr2)#" index="i" >
          <cfset header = header & "<th>#keyArr2[i]#</th>" >
          <!---cfdump var="#ngasArr2[ keyArr2[i] ]#"--->
          
          <cfscript>
						keyQtrArr = StructkeyArray(ngasArr2[ keyArr2[i] ]);
						ArraySort(keyQtrArr,'text','asc' );
						ngas = '';
						gold = '';
						copper = '';
						silver = '';
						soy = '';
						corn = '';
						wheat = '';
					</cfscript>

					<!--- loop through the quarters --->
          <cfloop from="1" to="4" index="e" >
          	<cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset ngasVal = #ngasArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset ngasVal = 'noVal' >
            </cfif>
            
            <cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset goldVal = #goldArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset goldVal = 'noVal' >
            </cfif>
            
            <cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset copperVal = #copperArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset copperVal = 'noVal' >
            </cfif>
            
            <cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset silverVal = #silverArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset silverVal = 'noVal' >
            </cfif>
            
            <cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset soyVal = #soyArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset soyVal = 'noVal' >
            </cfif>
            
            <cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset cornVal = #cornArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset cornVal = 'noVal' >
            </cfif>
            
            <cfif isArrayElementDefined2("keyQtrArr[#e#]")>
	          	<cfset wheatVal = #wheatArr2[ keyArr2[i] ][keyQtrArr[e]]# >
            <cfelse>
            	<cfset wheatVal = 'noVal' >
            </cfif>
						
            <cfif keyArr2[i] EQ '2008' AND keyQtrArr[e] EQ '03'>
							<cfset border = "oilPeak"> <!--- use class rightBorder but if shifts the whole span, not good--->
            <cfelse>
              <cfset border = "">
            </cfif>
            
          	<cfset ngas = ngas & "<span class=""qtr #getClassForValue2( ngasVal )# #border#"" alt=""Quarter #e#""></span>" > <!---  --->
            <cfset gold = gold & "<span class=""qtr #getClassForValue2( goldVal )# #border#"" alt=""Quarter #e#""></span>" >
            <cfset copper = copper & "<span class=""qtr #getClassForValue2( copperVal)# #border#"" alt=""Quarter #e#""></span>" >
            <cfset silver = silver & "<span class=""qtr #getClassForValue2( silverVal)# #border#"" alt=""Quarter #e#""></span>" >
            <cfset soy = soy & "<span class=""qtr #getClassForValue2( soyVal)# #border#"" alt=""Quarter #e#""></span>" >
            <cfset corn = corn & "<span class=""qtr #getClassForValue2( cornVal)# #border#"" alt=""Quarter #e#""></span>" >
            <cfset wheat = wheat & "<span class=""qtr #getClassForValue2( wheatVal)# #border#"" alt=""Quarter #e#""></span>" >
           
          </cfloop>
          
          <cfset ngasRow = ngasRow & "<td>#ngas#</td>">
          <cfset goldRow = goldRow & "<td>#gold#</td>">
          <cfset copperRow = copperRow & "<td>#copper#</td>">
          <cfset silverRow = silverRow & "<td>#silver#</td>">
          <cfset soyRow = soyRow & "<td>#soy#</td>">  
          <cfset cornRow = cornRow & "<td>#corn#</td>">  
          <cfset wheatRow = wheatRow & "<td>#wheat#</td>">  
                  
        </cfloop>
     	<tr>
      	<th></th> <!--- empty first header cell --->
        #header#
      </tr>
      <tr>
        #ngasRow#
      </tr>
      <tr>
        #goldRow#
      </tr>
      <tr>
        #copperRow#
      </tr>
      <tr>
        #silverRow#
      </tr>
      <tr>
        #soyRow#
      </tr>
      <tr>
        #cornRow#
      </tr>
      <tr>
        #wheatRow#
      </tr>
      </cfoutput>
    </table>
</div>
  <span class="peakLbl">WTI crude oil price peak</span>
  <div id="legend">
    
    <span class="vals negative high">< -0.65</span><span class="vals negative med">-0.65 to -0.4</span><span class="vals negative low">-0.4 to -0.25</span><span class="vals empty">-0.25 to 0.25</span><span class="vals positive low">0.25 to 0.4</span><span class="vals positive med">0.4 to 0.65</span><span class="vals positive high">> 0.65</span>

    <div><span>Negative Correlation</span><span>Positive Correlation</span></div>
  </div>
  <p><span style="color:gray;font-size:10px;">Source: <a href="http://www.eia.gov/">U.S. Energy Information Administration</a></span><br>
  	 <span style="color:grey;font-size:10px;">Updated: Quarterly | Last Updated: April 14, 2011</span></p>
  <p>* U.S. Dollar Index (DXY), which is a weighted index of a basket of currencies, per U.S. dollar. As the dollar strengthens against other currencies, the value of the index rises.</p>
  <p>** U.S. bonds is based on the negative of the change in yield on 30-year U.S. government bonds because as yields rise, bond prices fall.</p>
 
 <cfcatch> 
 	<cfdump var="#cfcatch#" />
 </cfcatch>
 </cftry>