<script type="text/javascript">
		var chart,
		opts_risk_factors = {
			chart: {
				renderTo: 'risk_factors',
				zoomType: 'x',
                marginTop: 60,
				marginBottom: 85					
			},
			credits: {
			  enabled: false
			},				
			title: {
				text: 'Imported crude oil refiner acquisition cost and WTI crude oil price',
				align: 'left',
				x: 0,
				y: 15,
				style:  {
				  color: 'black',
				  fontWeight: 'bold',
				  fontSize: '16px',
				  fontFamily: 'Arial'
				}
			},
			xAxis: {
				type: 'datetime',
				tickInterval: 5*365*24 * 3600 * 1000,
				lineColor: '#000000',
				labels: {
				  y: 20,
				  style: {
					color: 'black',
					fontFamily: 'Arial'
				  }
				}				
			},
			labels: {
				items: [{
					html: 'price per barrel (real 2009 dollars)',
					style:  {
						left: -25,
						top: -25,
					    color: 'black',
					    fontFamily: 'Arial'						
					} 
				},
				{
				  html: 'Source: <a href="http://www.eia.gov/">U.S. Energy Information Administration</a>,  <a href="http://thomsonreuters.com/">Thomson Reuters</a>.',
				  style:  {
					left:  '-20px',
					top:  '305px',
					color: 'gray',
					fontSize: '10px',
					fontFamily: 'Arial'
				  }
				},
				{
				  html: 'Updated: quarterly | Last Updated: April 14, 2011',
				  style:  {
					left:  '-20px',
					top:  '317px',
					color: 'gray',					
					fontSize: '10px',
					fontFamily: 'Arial'
				  }
				}				

				]
			},
		   legend: {
			  enabled: true,
			  layout: 'horizontal',
			  align: 'center',
			  verticalAlign: 'bottom',	  
			  x: 0,
			  y: -30,
			  borderWidth: 0,
			  symbolPadding: 5,					
			  itemStyle: {
				fontFamily: 'Arial',
				color: '#189bd7',
				textDecoration: 'none'
			  },
			  itemHoverStyle: {
				fontFamily: 'Arial',
				color: '#189bd7',
				textDecoration: 'underline'
			  }
			},			
			tooltip: {
					 style: { 
					padding: 5,
					fontFamily: 'Arial'
				  },			
				formatter: function() {
					var d = new Date(this.x),							
					quarter = {1:'1',2:'2',3:'3',4:'4'}[( d.getMonth() / 3) + 1],
					ret = '<b>' + this.series.name + '</b><br/>' + d.getFullYear() + ', quarter ' + quarter + '<br/>$' + this.y.toFixed(2) + ' per barrel';

					if( typeof(this.point.name) != 'undefined' )
						ret += '<br><b>'+this.point.name+'</b>';
				
					if( this.series.name == 'Events' )
						return '<b>' + this.point.name + '</b>';
				  else
						return ret; 
				}
			},
			yAxis: [{ // Primary yAxis
                title: null,
				labels: {
					style:{ 
						color: 'black',
						fontFamily: 'Arial'
					}
				}
				
      }],
			plotOptions: {
				series:{
					marker:{
						enabled:true,
						radius:0
					},
					dataLabels:{
						enabled:true,
						color:'#ffffff',
						formatter:function(){
							if( typeof(this.point.id) != 'undefined' ){
								return this.point.id;
							}
						},
						y:4
					}
				},
				line: {
					shadow:0,
					lineWidth: 2,
					marker: {
						states: {
							hover: {
								enabled: true,
								radius: 4
							}
						}
					},
					states: {
						hover: {
							lineWidth: 2,
							marker: {
									radius: 1
							}
						}
					}
				}
			},
			exporting: {
				buttons:{
					printButton: {
						enabled: false
					}
				}
			},
			navigation: {
				buttonOptions: {
					y: 0
				}
			},				
			colors:[
				'#5D9732',
				'#0096d7',
				'#a33340',
				'#003953',
				'#bd732a',
				'#103203',
				'#ffc702'
			],
			series: []
		},
		series1 = {
			data: [],
			type: 'line',
			color: 'rgba(0, 150, 215, 1.0)',
			name: 'Imported refiner acquisition cost'
		},
		series2 = {
			data: [],
			type: 'line',
			color: 'rgba(189, 115, 42, 1.0)',
			name: 'WTI crude oil'
		},
		events = {
			data:[],
			name: 'Events',
			type: 'scatter',
			color:'#000000',
			showInLegend: false
		},
		eventLst = [],
		ids = [];
			
	$(window).load(function() {
		//get events
		$.get( 'data/geopolitical_events.csv', function(data) {
			var lines = data.split('\n');

			$.each(lines, function(lineNo, line) {
				var items = line.split(','),
						date = Date.parse( items[0] ),
						label = items[1];
						eventLst[ date ] =  label;
			});
			
			$.get( 'data.cfm?chart=risk_factors', function(data) {
				var vals = data.DATA,
						i = 1;

				$.each(vals, function(lineNo, items) {
					var date = Date.parse( parseInt(items[1])*3-2 +'/1/'+ items[0]),
							val1 = parseFloat(items[2])||null,
							val2 = parseFloat(items[3])||null;
	
					if ( !isNaN( date ) ) {
						var hasEvent = (typeof(eventLst[date]) != 'undefined');
						/*if ( hasEvent ){
							events.data.push( { x:date, y:val1||val2, name:eventLst[date]} );
						}*/
						
						if(val1 != null && hasEvent )
							series1.data.push( {x:date, y:val1, name:eventLst[date], id:i++, marker:{ symbol:'circle', radius:8, fillColor:'#000000' }} );
						else
							series1.data.push( {x:date, y:val1} );
							
						if(val2 != null && hasEvent )
							series2.data.push( {x:date, y:val2, name:eventLst[date], id:i++, marker:{ symbol:'circle',radius:8, fillColor:'#000000' }} );
						else
							series2.data.push( {x:date, y:val2} );
					}
				});
				
				opts_risk_factors.series.push(series1);
				opts_risk_factors.series.push(series2);
				
				var chart = new Highcharts.Chart(opts_risk_factors),
								e = 0,
								col;
						eventLst.length = i-1;
				for( i in eventLst ){
					if( (e++) >= Math.ceil( eventLst.length/2 ) )
						col = '.col2';
					else
						col = '.col1';
						
					$('<div>'+e+': '+eventLst[i]+'</div>').appendTo('#footnotes '+ col);
				}
				
			chart.renderer.image('../..//global/images/icons/icon_interactive.gif', 625, 23, 69, 17)
			.add();	
			
			},'json'); //inner get
			
		
			
		});//outer get
		
		
	});
	</script>
	<style>
		#footnotes{
			margin:auto;
			position: relative;
			width: 75%;
		}
		
		.col1,
		.col2 {
			display:inline-block;
		}
		.col2 {
			position: absolute;
			right: 0;
			top: 0;
		}
  </style>

<div id="risk_factors"></div>
<div id="footnotes">
<span class="col1"></span>
<span class="col2"></span>
</div>